<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenText Content Server API Configuration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     
   
</head>
<body>
   <form name="myForm"><input class="button" onclick="fAuthUser()" type="BUTTON" value="Auth User" />
<p><input class="button" onclick="fGetUserInfo()" type="BUTTON" value="GetUserInfo" /></p>

<p><input class="button" onclick="fCreateFolder()" type="BUTTON" value="Create Folder" /></p>

<p><input class="button" onclick="fCreateProject()" type="BUTTON" value="Create Project" /></p>

<p><input id="newfile " onchange="getFileName(this)" type="file" /></p>
</form>
<SCRIPT LANGUAGE="javascript">

var myTicket;
var baseURL='http://localhost/otcs/cs.exe';
var credentials = { userName: "Admin", password: "Santu@123" };



// ************************************************************************
function makeId() {
  var text = "";
  var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

  for (var i = 0; i < 10; i++)
    text += possible.charAt(Math.floor(Math.random() * possible.length));

dt= new Date().toISOString().slice(0,10);  

return text+"-"+ dt;
}


// ************************************************************************
function fAuthUser( ) {
  var url = baseURL+'/api/v1/auth';


  $.support.cors = true;
  $.ajax({
url:url,
type:"POST",
crossDomain: true,
data:credentials,
dataType:"json",
contentType: "application/x-www-form-urlencoded",
success:function(res){
alert("Ticket=" + res.ticket);
myTicket = res.ticket;
},
error:function(res){
alert("Bad thing happened! " + res.statusText);
}
});
}

// ************************************************************************
function fGetUserInfo ( ) {
alert(myTicket);
$(document).ready(function(){
var url = baseURL+'/api/v1/auth';
$.support.cors = true;
$.ajax({
url:url,
type:"GET",
crossDomain: true,
dataType:"json",
headers: { "OTCSTICKET": myTicket },
success:function(userInfo){
alert("success!");
alert(userInfo.data.first_name);
},
error:function(userInfo){
alert("Bad thing happened! " + userInfo.statusText);
}
});
});
}

// ************************************************************************
function fCreateFolder ( ) {
alert(myTicket);
  //var myBody = { type: "0", parent_id: "24290", name: "test rest api folder" };

var name=new Date().toISOString().substring(0, 10);
  var myBody = { type: "0", parent_id: "25752", name: "Project - " + makeId()};


$(document).ready(function(){

var url = baseURL+'/api/v1/nodes';
$.support.cors = true;
$.ajax({
url:url,
type:"POST",
crossDomain: true,
data:myBody,
dataType:"json",
headers: { "OTCSTICKET": myTicket },
success:function(res){
alert("success!");
alert("Folder object id = " + res.id);
},
error:function(res){
alert("Bad thing happened! " + res.statusText);
}
});
});
}




// ************************************************************************
function fCreateProject ( ) {
alert(myTicket);
  //var myBody = { type: "202", parent_id: "24290", name: "test rest api folder" };

var name=new Date().toISOString().substring(0, 10);
  var myBody = { type: "202", parent_id: "25752", name: "Project - " + makeId()};


$(document).ready(function(){

var url = baseURL+'/api/v2/nodes';
$.support.cors = true;
$.ajax({
url:url,
type:"POST",
crossDomain: true,
data:myBody,
dataType:"json",
headers: { "OTCSTICKET": myTicket },
success:function(res){
alert("success!");
alert("Folder object id = " + res.id);
},
error:function(res){
alert("Bad thing happened! " + res.statusText);
}
});
});
}



// ************************************************************************

function fCreateDoc (file) {
    alert("CreateDoc: " + myTicket);
    var myBody = { type: "144", parent_id: "25752", name: file.name };
formData = new FormData();
formData.append('body', JSON.stringify(myBody));
formData.append('file', file);
$(document).ready(function(){
var url = baseURL+'/api/v1/nodes';
$.support.cors = true;
$.ajax({
url:url,
type:"POST",
crossDomain: true,
data:formData,
processData: false,
                                contentType: false,
headers: { "OTCSTICKET": myTicket },
success:function(res){
alert("success!");
alert(res);
},
error:function(res){
alert("Bad thing happened! " + res.statusText);
alert(res);
console.log("Bad thing happend! " + res.statusText);
console.log(res);
}
});
});
}




function getFileName(elm) {
 //alert(elm);
 var file = elm.files[0];
var fn = $(elm).val();
// alert(file)
   //upload(file);

fCreateDoc(file);

}


</SCRIPT>
</body>
</html>


